import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  Pressable,
  Modal,
  TextInput,
  Alert
} from 'react-native';
import * as Animatable from 'react-native-animatable';
import * as Haptics from 'expo-haptics';
import { useAuth } from '../providers/AuthProvider';
import GradientBackground from '../components/GradientBackground';
import { COLORS, TYPOGRAPHY, SPACING, BORDER_RADIUS } from '../config/theme';

export default function CommunityScreen({ navigation }) {
  const { profile, user } = useAuth();
  const [selectedTab, setSelectedTab] = useState('feed');
  const [communityData, setCommunityData] = useState({
    peers: [],
    successStories: [],
    helpRequests: [],
    studyGroups: [],
    mentors: []
  });
  const [showHelpModal, setShowHelpModal] = useState(false);
  const [showStoryModal, setShowStoryModal] = useState(false);
  const [userCommunityProfile, setUserCommunityProfile] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    // Load data immediately without waiting for user/profile
    loadCommunityData();
    loadUserCommunityProfile();
  }, []);

  const loadCommunityData = async () => {
    try {
      // Load mock data immediately
      const mockSuccessStories = [
        {
          id: 'story1',
          title: 'рдореИрдВрдиреЗ UPI рд╕реАрдЦрдХрд░ рдЕрдкрдирд╛ рдмрд┐рдЬрдиреЗрд╕ рдмрдврд╝рд╛рдпрд╛',
          content: 'рджреАрджреА рдХреЗ рд╕рд╛рде рд╕реАрдЦрдХрд░ рдореИрдВрдиреЗ рдбрд┐рдЬрд┐рдЯрд▓ рдкреЗрдореЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕реАрдЦрд╛ред рдЕрдм рдореЗрд░реЗ рдЧреНрд░рд╛рд╣рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рдкреЗрдореЗрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред',
          category: 'digital_literacy',
          likes: 25,
          comments: [],
          createdAt: Date.now() - 86400000
        },
        {
          id: 'story2',
          title: 'рдкрдврд╝рдирд╛-рд▓рд┐рдЦрдирд╛ рд╕реАрдЦрдХрд░ рдореИрдВ рдЖрддреНрдордирд┐рд░реНрднрд░ рдмрдиреА',
          content: 'рдЕрдм рдореИрдВ рдЕрдкрдиреЗ рдмрдЪреНрдЪреЛрдВ рдХреЗ рд╕реНрдХреВрд▓ рдХреЗ рдлреЙрд░реНрдо рдЦреБрдж рднрд░ рд╕рдХрддреА рд╣реВрдВред рдмрд╣реБрдд рдЦреБрд╢реА рдХреА рдмрд╛рдд рд╣реИред',
          category: 'functional_literacy',
          likes: 18,
          comments: [],
          createdAt: Date.now() - 172800000
        },
        {
          id: 'story3',
          title: 'рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╕реЗ рдмрджрд▓реА рдореЗрд░реА рдЬрд┐рдВрджрдЧреА',
          content: 'рджреАрджреА рд╕реЗ рд╕реАрдЦрдХрд░ рдореИрдВрдиреЗ рдЕрдкрдиреЗ рдФрд░ рдЕрдкрдиреЗ рдкрд░рд┐рд╡рд╛рд░ рдХреЗ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХрд╛ рдмреЗрд╣рддрд░ рдЦреНрдпрд╛рд▓ рд░рдЦрдирд╛ рд╕реАрдЦрд╛ред',
          category: 'health_education',
          likes: 32,
          comments: [],
          createdAt: Date.now() - 259200000
        }
      ];

      const mockPeers = [
        {
          id: 'peer1',
          displayName: 'рд╕реБрдиреАрддрд╛ рджреАрджреА',
          location: { district: 'рд▓рдЦрдирдК', state: 'рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢' },
          learningGoals: ['рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд╛рдХреНрд╖рд░рддрд╛', 'рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╢рд┐рдХреНрд╖рд╛'],
          completedModules: ['digital_basics'],
          communityStats: { reputationScore: 45 },
          compatibility: 85
        },
        {
          id: 'peer2',
          displayName: 'рдкреНрд░рд┐рдпрд╛ рдмрд╣рди',
          location: { district: 'рдХрд╛рдирдкреБрд░', state: 'рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢' },
          learningGoals: ['рд╡рд┐рддреНрддреАрдп рд╕рд╛рдХреНрд╖рд░рддрд╛', 'рдкрдврд╝рдирд╛-рд▓рд┐рдЦрдирд╛'],
          completedModules: ['functional_literacy'],
          communityStats: { reputationScore: 32 },
          compatibility: 78
        },
        {
          id: 'peer3',
          displayName: 'рдЕрдиреАрддрд╛ рдЬреА',
          location: { district: 'рдЖрдЧрд░рд╛', state: 'рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢' },
          learningGoals: ['рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╢рд┐рдХреНрд╖рд╛', 'рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд╛рдХреНрд╖рд░рддрд╛'],
          completedModules: ['health_education'],
          communityStats: { reputationScore: 58 },
          compatibility: 92
        }
      ];

      setCommunityData({
        successStories: mockSuccessStories,
        peers: mockPeers,
        helpRequests: [],
        studyGroups: [],
        mentors: []
      });
      
    } catch (error) {
      console.error('Error loading community data:', error);
    }
  };

  const loadUserCommunityProfile = async () => {
    try {
      // Create mock community profile using available user data
      const mockCommunityProfile = {
        userId: user?.uid || 'demo_user',
        displayName: profile?.name || user?.displayName || 'рджреАрджреА рдХреА рд╕рд╣реЗрд▓реА',
        communityStats: {
          reputationScore: 25,
          helpGiven: 2,
          storiesShared: 1,
          questionsAnswered: 3
        }
      };
      
      setUserCommunityProfile(mockCommunityProfile);
    } catch (error) {
      console.error('Error loading user community profile:', error);
    }
  };

  const handleRequestHelp = async (helpData) => {
    try {
      setShowHelpModal(false);
      Alert.alert('рд╕рдлрд▓рддрд╛', 'рдЖрдкрдХреА рдорджрдж рдХреА рдЕрдиреБрд░реЛрдз рднреЗрдЬ рджреА рдЧрдИ рд╣реИред рдЬрд▓реНрдж рд╣реА рдХреЛрдИ рдЖрдкрдХреА рдорджрдж рдХрд░реЗрдЧрд╛ред');
      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    } catch (error) {
      Alert.alert('рддреНрд░реБрдЯрд┐', 'рдорджрдж рдХреА рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рд╣реБрдИред');
    }
  };

  const handleShareStory = async (storyData) => {
    try {
      setShowStoryModal(false);
      Alert.alert('рдзрдиреНрдпрд╡рд╛рдж', 'рдЖрдкрдХреА рд╕рдлрд▓рддрд╛ рдХреА рдХрд╣рд╛рдиреА рд╕рд╛рдЭрд╛ рдХрд░ рджреА рдЧрдИ рд╣реИред рдпрд╣ рджреВрд╕рд░реЛрдВ рдХреЛ рдкреНрд░реЗрд░рдгрд╛ рджреЗрдЧреАред');
      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
      
      // Add to local state for immediate feedback
      const newStory = {
        id: `story_${Date.now()}`,
        title: storyData.title,
        content: storyData.content,
        category: storyData.category,
        likes: 0,
        comments: [],
        createdAt: Date.now()
      };
      
      setCommunityData(prev => ({
        ...prev,
        successStories: [newStory, ...prev.successStories]
      }));
    } catch (error) {
      Alert.alert('рддреНрд░реБрдЯрд┐', 'рдХрд╣рд╛рдиреА рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рд╣реБрдИред');
    }
  };

  const renderFeedTab = () => (
    <ScrollView showsVerticalScrollIndicator={false}>
      {/* Community Stats */}
      <Animatable.View animation="fadeInUp" style={styles.statsCard}>
        <Text style={styles.cardTitle}>рд╕рдореБрджрд╛рдп рдореЗрдВ рдЖрдкрдХреА рд╕реНрдерд┐рддрд┐</Text>
        {userCommunityProfile && (
          <View style={styles.statsRow}>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{userCommunityProfile.communityStats.reputationScore}</Text>
              <Text style={styles.statLabel}>рдкреНрд░рддрд┐рд╖реНрдард╛</Text>
            </View>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{userCommunityProfile.communityStats.helpGiven}</Text>
              <Text style={styles.statLabel}>рдорджрдж рдХреА</Text>
            </View>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{userCommunityProfile.communityStats.storiesShared}</Text>
              <Text style={styles.statLabel}>рдХрд╣рд╛рдирд┐рдпрд╛рдВ</Text>
            </View>
          </View>
        )}
      </Animatable.View>

      {/* Quick Actions */}
      <Animatable.View animation="fadeInUp" delay={200} style={styles.actionsCard}>
        <Text style={styles.cardTitle}>рд╕рдореБрджрд╛рдп рдореЗрдВ рднрд╛рдЧ рд▓реЗрдВ</Text>
        <View style={styles.actionButtons}>
          <Pressable style={styles.actionButton} onPress={() => setShowHelpModal(true)}>
            <Text style={styles.actionIcon}>ЁЯдЭ</Text>
            <Text style={styles.actionText}>рдорджрдж рдорд╛рдВрдЧреЗрдВ</Text>
          </Pressable>
          <Pressable style={styles.actionButton} onPress={() => setShowStoryModal(true)}>
            <Text style={styles.actionIcon}>тЬи</Text>
            <Text style={styles.actionText}>рдХрд╣рд╛рдиреА рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ</Text>
          </Pressable>
          <Pressable style={styles.actionButton} onPress={() => setSelectedTab('mentors')}>
            <Text style={styles.actionIcon}>ЁЯСйтАНЁЯПл</Text>
            <Text style={styles.actionText}>рдореЗрдВрдЯрд░ рдЦреЛрдЬреЗрдВ</Text>
          </Pressable>
        </View>
      </Animatable.View>

      {/* Success Stories */}
      <Animatable.View animation="fadeInUp" delay={400} style={styles.storiesSection}>
        <Text style={styles.sectionTitle}>ЁЯМЯ рд╕рдлрд▓рддрд╛ рдХреА рдХрд╣рд╛рдирд┐рдпрд╛рдВ</Text>
        {communityData.successStories.map((story, index) => (
          <Animatable.View 
            key={story.id} 
            animation="fadeInUp" 
            delay={index * 100}
            style={styles.storyCard}
          >
            <View style={styles.storyHeader}>
              <Text style={styles.storyTitle}>{story.title}</Text>
              <Text style={styles.storyDate}>
                {new Date(story.createdAt).toLocaleDateString('hi-IN')}
              </Text>
            </View>
            <Text style={styles.storyContent} numberOfLines={3}>
              {story.content}
            </Text>
            <View style={styles.storyFooter}>
              <Text style={styles.storyCategory}>#{story.category}</Text>
              <View style={styles.storyStats}>
                <Text style={styles.storyStat}>ЁЯСН {story.likes}</Text>
                <Text style={styles.storyStat}>ЁЯТм {story.comments.length}</Text>
              </View>
            </View>
          </Animatable.View>
        ))}
      </Animatable.View>
    </ScrollView>
  );

  const renderPeersTab = () => (
    <ScrollView showsVerticalScrollIndicator={false}>
      <Animatable.View animation="fadeInUp" style={styles.peersSection}>
        <Text style={styles.sectionTitle}>ЁЯСн рдЖрдкрдХреЗ рдЬреИрд╕реА рд╕рд╣реЗрд▓рд┐рдпрд╛рдВ</Text>
        <Text style={styles.sectionDesc}>
          рдЕрдкрдиреЗ рдЖрд╕-рдкрд╛рд╕ рдХреА рдорд╣рд┐рд▓рд╛рдУрдВ рд╕реЗ рдЬреБрдбрд╝реЗрдВ рдФрд░ рдПрдХ рд╕рд╛рде рд╕реАрдЦреЗрдВ
        </Text>
        {communityData.peers.map((peer, index) => (
          <Animatable.View 
            key={peer.id} 
            animation="fadeInUp" 
            delay={index * 150}
            style={styles.peerCard}
          >
            <View style={styles.peerHeader}>
              <Text style={styles.peerName}>{peer.displayName}</Text>
              <Text style={styles.compatibilityScore}>
                {Math.round(peer.compatibility)}% рдореИрдЪ
              </Text>
            </View>
            <Text style={styles.peerLocation}>
              ЁЯУН {peer.location.district}, {peer.location.state}
            </Text>
            <View style={styles.peerGoals}>
              {peer.learningGoals.slice(0, 3).map((goal, idx) => (
                <Text key={idx} style={styles.goalTag}>#{goal}</Text>
              ))}
            </View>
            <View style={styles.peerStats}>
              <Text style={styles.peerStat}>
                ЁЯУЪ {peer.completedModules.length} рдореЙрдбреНрдпреВрд▓ рдкреВрд░реЗ
              </Text>
              <Text style={styles.peerStat}>
                тнР {peer.communityStats.reputationScore} рдкреНрд░рддрд┐рд╖реНрдард╛
              </Text>
            </View>
            <Pressable 
              style={styles.connectButton}
              onPress={() => Alert.alert('рдЬрд▓реНрдж рдЖ рд░рд╣рд╛ рд╣реИ', 'рдпрд╣ рдлреАрдЪрд░ рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ред')}
            >
              <Text style={styles.connectButtonText}>рдЬреБрдбрд╝реЗрдВ</Text>
            </Pressable>
          </Animatable.View>
        ))}
      </Animatable.View>
    </ScrollView>
  );

  const renderMentorsTab = () => (
    <ScrollView showsVerticalScrollIndicator={false}>
      <Animatable.View animation="fadeInUp" style={styles.mentorsSection}>
        <Text style={styles.sectionTitle}>ЁЯСйтАНЁЯПл рдореЗрдВрдЯрд░реНрд╕</Text>
        <Text style={styles.sectionDesc}>
          рдЕрдиреБрднрд╡реА рджреАрджрд┐рдпреЛрдВ рд╕реЗ рд╕реАрдЦреЗрдВ рдФрд░ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкрд╛рдПрдВ
        </Text>
        
        {/* Mock mentors */}
        <Animatable.View animation="fadeInUp" delay={200} style={styles.mentorCard}>
          <View style={styles.mentorHeader}>
            <Text style={styles.mentorName}>рдкреНрд░рд┐рдпрд╛ рджреАрджреА</Text>
            <Text style={styles.mentorRating}>тнР 4.8</Text>
          </View>
          <Text style={styles.mentorExpertise}>
            рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛: рдбрд┐рдЬрд┐рдЯрд▓ рдкреЗя┐╜я┐╜реЗрдВрдЯ, рдмреИрдВрдХрд┐рдВрдЧ, рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ
          </Text>
          <Text style={styles.mentorExperience}>
            5 рд╕рд╛рд▓ рдХрд╛ рдЕрдиреБрднрд╡ тАв 50+ рдорд╣рд┐рд▓рд╛рдУрдВ рдХреА рдорджрдж рдХреА
          </Text>
          <Pressable 
            style={styles.mentorButton}
            onPress={() => Alert.alert('рдЬрд▓реНрдж рдЖ рд░рд╣рд╛ рд╣реИ', 'рдореЗрдВрдЯрд░ рдХрдиреЗрдХреНрд╢рди рдлреАрдЪрд░ рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ред')}
          >
            <Text style={styles.mentorButtonText}>рдореЗрдВрдЯрд░ рд╕реЗ рдЬреБрдбрд╝реЗрдВ</Text>
          </Pressable>
        </Animatable.View>

        <Animatable.View animation="fadeInUp" delay={400} style={styles.mentorCard}>
          <View style={styles.mentorHeader}>
            <Text style={styles.mentorName}>рд╕реБрдиреАрддрд╛ рджреАрджреА</Text>
            <Text style={styles.mentorRating}>тнР 4.9</Text>
          </View>
          <Text style={styles.mentorExpertise}>
            рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛: рдкрдврд╝рдирд╛-рд▓рд┐рдЦрдирд╛, рдЕрдВрдЧреНрд░реЗрдЬреА, рдмрдЪреНрдЪреЛрдВ рдХреА рд╢рд┐рдХреНрд╖рд╛
          </Text>
          <Text style={styles.mentorExperience}>
            3 рд╕рд╛рд▓ рдХрд╛ рдЕрдиреБрднрд╡ тАв 30+ рдорд╣рд┐рд▓рд╛рдУрдВ рдХреА рдорджрдж рдХреА
          </Text>
          <Pressable 
            style={styles.mentorButton}
            onPress={() => Alert.alert('рдЬрд▓реНрдж рдЖ рд░рд╣рд╛ рд╣реИ', 'рдореЗрдВрдЯрд░ рдХрдиреЗрдХреНрд╢рди рдлреАрдЪрд░ рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ред')}
          >
            <Text style={styles.mentorButtonText}>рдореЗрдВрдЯрд░ рд╕реЗ рдЬреБрдбрд╝реЗрдВ</Text>
          </Pressable>
        </Animatable.View>

        <Animatable.View animation="fadeInUp" delay={600} style={styles.mentorCard}>
          <View style={styles.mentorHeader}>
            <Text style={styles.mentorName}>рдЕрдиреАрддрд╛ рдЬреА</Text>
            <Text style={styles.mentorRating}>тнР 4.7</Text>
          </View>
          <Text style={styles.mentorExpertise}>
            рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛: рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╢рд┐рдХреНрд╖рд╛, рдкреЛрд╖рдг, рдорд╛рддреГрддреНрд╡ рджреЗрдЦрднрд╛рд▓
          </Text>
          <Text style={styles.mentorExperience}>
            4 рд╕рд╛рд▓ рдХрд╛ рдЕрдиреБрднрд╡ тАв 40+ рдорд╣рд┐рд▓рд╛рдУрдВ рдХреА рдорджрдж рдХреА
          </Text>
          <Pressable 
            style={styles.mentorButton}
            onPress={() => Alert.alert('рдЬрд▓реНрдж рдЖ рд░рд╣рд╛ рд╣реИ', 'рдореЗрдВрдЯрд░ рдХрдиреЗрдХреНрд╢рди рдлреАрдЪрд░ рдЬрд▓реНрдж рд╣реА рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ред')}
          >
            <Text style={styles.mentorButtonText}>рдореЗрдВрдЯрд░ рд╕реЗ рдЬреБрдбрд╝реЗрдВ</Text>
          </Pressable>
        </Animatable.View>
      </Animatable.View>
    </ScrollView>
  );

  const renderHelpModal = () => (
    <Modal visible={showHelpModal} animationType="slide" onRequestClose={() => setShowHelpModal(false)}>
      <GradientBackground colors={[COLORS.background.primary, COLORS.background.surface]}>
        <ScrollView style={styles.modalContainer}>
          <View style={styles.modalHeader}>
            <Text style={styles.modalTitle}>рдорджрдж рдорд╛рдВрдЧреЗрдВ</Text>
            <Pressable onPress={() => setShowHelpModal(false)} style={styles.closeButton}>
              <Text style={styles.closeButtonText}>тЬХ</Text>
            </Pressable>
          </View>
          
          <HelpRequestForm onSubmit={handleRequestHelp} />
        </ScrollView>
      </GradientBackground>
    </Modal>
  );

  const renderStoryModal = () => (
    <Modal visible={showStoryModal} animationType="slide" onRequestClose={() => setShowStoryModal(false)}>
      <GradientBackground colors={[COLORS.background.primary, COLORS.background.surface]}>
        <ScrollView style={styles.modalContainer}>
          <View style={styles.modalHeader}>
            <Text style={styles.modalTitle}>рд╕рдлрд▓рддрд╛ рдХреА рдХрд╣рд╛рдиреА рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ</Text>
            <Pressable onPress={() => setShowStoryModal(false)} style={styles.closeButton}>
              <Text style={styles.closeButtonText}>тЬХ</Text>
            </Pressable>
          </View>
          
          <SuccessStoryForm onSubmit={handleShareStory} />
        </ScrollView>
      </GradientBackground>
    </Modal>
  );

  return (
    <GradientBackground colors={[COLORS.background.primary, COLORS.background.surface]}>
      <View style={styles.container}>
        {/* Header */}
        <View style={styles.header}>
          <Text style={styles.headerTitle}>рд╕рдореБрджрд╛рдп</Text>
          <Text style={styles.headerSubtitle}>Community Learning</Text>
        </View>

        {/* Tab Navigation */}
        <View style={styles.tabContainer}>
          <Pressable 
            style={[styles.tab, selectedTab === 'feed' && styles.activeTab]}
            onPress={() => setSelectedTab('feed')}
          >
            <Text style={[styles.tabText, selectedTab === 'feed' && styles.activeTabText]}>
              рдлреАрдб
            </Text>
          </Pressable>
          <Pressable 
            style={[styles.tab, selectedTab === 'peers' && styles.activeTab]}
            onPress={() => setSelectedTab('peers')}
          >
            <Text style={[styles.tabText, selectedTab === 'peers' && styles.activeTabText]}>
              рд╕рд╣реЗрд▓рд┐рдпрд╛рдВ
            </Text>
          </Pressable>
          <Pressable 
            style={[styles.tab, selectedTab === 'mentors' && styles.activeTab]}
            onPress={() => setSelectedTab('mentors')}
          >
            <Text style={[styles.tabText, selectedTab === 'mentors' && styles.activeTabText]}>
              рдореЗрдВрдЯрд░реНрд╕
            </Text>
          </Pressable>
        </View>

        {/* Tab Content */}
        <View style={styles.tabContent}>
          {selectedTab === 'feed' && renderFeedTab()}
          {selectedTab === 'peers' && renderPeersTab()}
          {selectedTab === 'mentors' && renderMentorsTab()}
        </View>
      </View>

      {renderHelpModal()}
      {renderStoryModal()}
    </GradientBackground>
  );
}

// Help Request Form Component
function HelpRequestForm({ onSubmit }) {
  const [title, setTitle] = useState('');
  const [description, setDescription] = useState('');
  const [category, setCategory] = useState('learning');

  const handleSubmit = () => {
    if (!title.trim() || !description.trim()) {
      Alert.alert('рддреНрд░реБрдЯрд┐', 'рдХреГрдкрдпрд╛ рд╕рднреА рдлреАрд▓реНрдб рднрд░реЗрдВред');
      return;
    }

    onSubmit({
      title: title.trim(),
      description: description.trim(),
      category,
      urgency: 'medium',
      tags: [category]
    });
  };

  return (
    <View style={styles.formContainer}>
      <Text style={styles.formLabel}>рдорджрдж рдХрд╛ рд╡рд┐рд╖рдп</Text>
      <TextInput
        style={styles.formInput}
        placeholder="рдЬреИрд╕реЗ: UPI рд╕реЗ рдкреЗрдореЗрдВрдЯ рдХреИрд╕реЗ рдХрд░реЗрдВ?"
        value={title}
        onChangeText={setTitle}
      />

      <Text style={styles.formLabel}>рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдПрдВ</Text>
      <TextInput
        style={[styles.formInput, styles.textArea]}
        placeholder="рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВ..."
        value={description}
        onChangeText={setDescription}
        multiline
        numberOfLines={4}
      />

      <Text style={styles.formLabel}>рд╢реНрд░реЗрдгреА</Text>
      <View style={styles.categoryButtons}>
        {['learning', 'technical', 'practical'].map(cat => (
          <Pressable
            key={cat}
            style={[styles.categoryButton, category === cat && styles.selectedCategory]}
            onPress={() => setCategory(cat)}
          >
            <Text style={[styles.categoryText, category === cat && styles.selectedCategoryText]}>
              {cat === 'learning' ? 'рд╕реАрдЦрдирд╛' : cat === 'technical' ? 'рддрдХрдиреАрдХреА' : 'рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ'}
            </Text>
          </Pressable>
        ))}
      </View>

      <Pressable style={styles.submitButton} onPress={handleSubmit}>
        <Text style={styles.submitButtonText}>рдорджрдж рдорд╛рдВрдЧреЗрдВ</Text>
      </Pressable>
    </View>
  );
}

// Success Story Form Component
function SuccessStoryForm({ onSubmit }) {
  const [title, setTitle] = useState('');
  const [content, setContent] = useState('');
  const [category, setCategory] = useState('learning');

  const handleSubmit = () => {
    if (!title.trim() || !content.trim()) {
      Alert.alert('рддреНрд░реБрдЯрд┐', 'рдХреГрдкрдпрд╛ рд╕рднреА рдлреАрд▓реНрдб рднрд░реЗрдВред');
      return;
    }

    onSubmit({
      title: title.trim(),
      content: content.trim(),
      category,
      tags: [category]
    });
  };

  return (
    <View style={styles.formContainer}>
      <Text style={styles.formLabel}>рдХрд╣рд╛рдиреА рдХрд╛ рд╢реАрд░реНрд╖рдХ</Text>
      <TextInput
        style={styles.formInput}
        placeholder="рдЬреИрд╕реЗ: рдореИрдВрдиреЗ UPI рд╕реАрдЦрдХрд░ рдЕрдкрдирд╛ рдмрд┐рдЬрдиреЗрд╕ рдмрдврд╝я┐╜я┐╜я┐╜рдпрд╛"
        value={title}
        onChangeText={setTitle}
      />

      <Text style={styles.formLabel}>рдЕрдкрдиреА рдХрд╣рд╛рдиреА</Text>
      <TextInput
        style={[styles.formInput, styles.textArea]}
        placeholder="рдмрддрд╛рдПрдВ рдХрд┐ рдЖрдкрдиреЗ рдХреНрдпрд╛ рд╕реАрдЦрд╛ рдФрд░ рдЗрд╕рд╕реЗ рдЖрдкрдХреА рдЬрд┐рдВрджрдЧреА рдХреИрд╕реЗ рдмрджрд▓реА..."
        value={content}
        onChangeText={setContent}
        multiline
        numberOfLines={6}
      />

      <Pressable style={styles.submitButton} onPress={handleSubmit}>
        <Text style={styles.submitButtonText}>рдХрд╣рд╛рдиреА рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ</Text>
      </Pressable>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: SPACING.lg,
  },
  header: {
    alignItems: 'center',
    marginBottom: SPACING.lg,
    marginTop: SPACING.md,
  },
  headerTitle: {
    fontSize: TYPOGRAPHY.fontSize['2xl'],
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
    marginBottom: SPACING.xs,
  },
  headerSubtitle: {
    fontSize: TYPOGRAPHY.fontSize.base,
    color: COLORS.text.secondary,
  },
  tabContainer: {
    flexDirection: 'row',
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.xs,
    marginBottom: SPACING.lg,
  },
  tab: {
    flex: 1,
    paddingVertical: SPACING.md,
    alignItems: 'center',
    borderRadius: BORDER_RADIUS.md,
  },
  activeTab: {
    backgroundColor: COLORS.primary[500],
  },
  tabText: {
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
    color: COLORS.text.secondary,
  },
  activeTabText: {
    color: '#fff',
  },
  tabContent: {
    flex: 1,
  },
  // Feed Tab Styles
  statsCard: {
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.lg,
    marginBottom: SPACING.lg,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  cardTitle: {
    fontSize: TYPOGRAPHY.fontSize.lg,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
    marginBottom: SPACING.md,
  },
  statsRow: {
    flexDirection: 'row',
    justifyContent: 'space-around',
  },
  statItem: {
    alignItems: 'center',
  },
  statNumber: {
    fontSize: TYPOGRAPHY.fontSize.xl,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.primary[500],
    marginBottom: SPACING.xs,
  },
  statLabel: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
  },
  actionsCard: {
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.lg,
    marginBottom: SPACING.lg,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  actionButtons: {
    flexDirection: 'row',
    justifyContent: 'space-around',
  },
  actionButton: {
    alignItems: 'center',
    padding: SPACING.md,
  },
  actionIcon: {
    fontSize: 32,
    marginBottom: SPACING.sm,
  },
  actionText: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.primary,
    textAlign: 'center',
  },
  storiesSection: {
    marginBottom: SPACING.lg,
  },
  sectionTitle: {
    fontSize: TYPOGRAPHY.fontSize.lg,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
    marginBottom: SPACING.md,
  },
  sectionDesc: {
    fontSize: TYPOGRAPHY.fontSize.base,
    color: COLORS.text.secondary,
    marginBottom: SPACING.md,
    textAlign: 'center',
  },
  storyCard: {
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.lg,
    marginBottom: SPACING.md,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  storyHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: SPACING.sm,
  },
  storyTitle: {
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
    flex: 1,
  },
  storyDate: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
  },
  storyContent: {
    fontSize: TYPOGRAPHY.fontSize.base,
    color: COLORS.text.primary,
    lineHeight: 22,
    marginBottom: SPACING.md,
  },
  storyFooter: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  storyCategory: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.primary[600],
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
  },
  storyStats: {
    flexDirection: 'row',
    gap: SPACING.md,
  },
  storyStat: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
  },
  // Peers Tab Styles
  peersSection: {
    marginBottom: SPACING.lg,
  },
  peerCard: {
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.lg,
    marginBottom: SPACING.md,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  peerHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: SPACING.sm,
  },
  peerName: {
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
  },
  compatibilityScore: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.status.success,
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
  },
  peerLocation: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
    marginBottom: SPACING.sm,
  },
  peerGoals: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    gap: SPACING.xs,
    marginBottom: SPACING.sm,
  },
  goalTag: {
    fontSize: TYPOGRAPHY.fontSize.xs,
    color: COLORS.primary[600],
    backgroundColor: COLORS.primary[100],
    paddingHorizontal: SPACING.sm,
    paddingVertical: SPACING.xs,
    borderRadius: BORDER_RADIUS.sm,
  },
  peerStats: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: SPACING.md,
  },
  peerStat: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
  },
  connectButton: {
    backgroundColor: COLORS.primary[500],
    paddingVertical: SPACING.sm,
    paddingHorizontal: SPACING.md,
    borderRadius: BORDER_RADIUS.md,
    alignSelf: 'flex-start',
  },
  connectButtonText: {
    color: '#fff',
    fontSize: TYPOGRAPHY.fontSize.sm,
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
  },
  // Mentors Tab Styles
  mentorsSection: {
    marginBottom: SPACING.lg,
  },
  mentorCard: {
    backgroundColor: COLORS.background.card,
    borderRadius: BORDER_RADIUS.lg,
    padding: SPACING.lg,
    marginBottom: SPACING.md,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  mentorHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: SPACING.sm,
  },
  mentorName: {
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
  },
  mentorRating: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.status.warning,
  },
  mentorExpertise: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.primary,
    marginBottom: SPACING.sm,
  },
  mentorExperience: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.secondary,
    marginBottom: SPACING.md,
  },
  mentorButton: {
    backgroundColor: COLORS.secondary[500],
    paddingVertical: SPACING.sm,
    paddingHorizontal: SPACING.md,
    borderRadius: BORDER_RADIUS.md,
    alignSelf: 'flex-start',
  },
  mentorButtonText: {
    color: COLORS.text.primary,
    fontSize: TYPOGRAPHY.fontSize.sm,
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
  },
  // Modal Styles
  modalContainer: {
    flex: 1,
    padding: SPACING.lg,
  },
  modalHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginTop: SPACING.xl,
    marginBottom: SPACING.lg,
  },
  modalTitle: {
    fontSize: TYPOGRAPHY.fontSize.xl,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
    color: COLORS.text.primary,
  },
  closeButton: {
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: COLORS.neutral.gray[200],
    alignItems: 'center',
    justifyContent: 'center',
  },
  closeButtonText: {
    fontSize: TYPOGRAPHY.fontSize.lg,
    color: COLORS.text.primary,
  },
  // Form Styles
  formContainer: {
    marginBottom: SPACING.xl,
  },
  formLabel: {
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.semibold,
    color: COLORS.text.primary,
    marginBottom: SPACING.sm,
  },
  formInput: {
    backgroundColor: COLORS.background.surface,
    borderRadius: BORDER_RADIUS.md,
    padding: SPACING.md,
    fontSize: TYPOGRAPHY.fontSize.base,
    color: COLORS.text.primary,
    borderWidth: 1,
    borderColor: COLORS.border,
    marginBottom: SPACING.md,
  },
  textArea: {
    minHeight: 100,
    textAlignVertical: 'top',
  },
  categoryButtons: {
    flexDirection: 'row',
    gap: SPACING.sm,
    marginBottom: SPACING.lg,
  },
  categoryButton: {
    flex: 1,
    paddingVertical: SPACING.sm,
    paddingHorizontal: SPACING.md,
    borderRadius: BORDER_RADIUS.md,
    borderWidth: 1,
    borderColor: COLORS.border,
    alignItems: 'center',
  },
  selectedCategory: {
    backgroundColor: COLORS.primary[500],
    borderColor: COLORS.primary[500],
  },
  categoryText: {
    fontSize: TYPOGRAPHY.fontSize.sm,
    color: COLORS.text.primary,
  },
  selectedCategoryText: {
    color: '#fff',
  },
  submitButton: {
    backgroundColor: COLORS.primary[500],
    paddingVertical: SPACING.md,
    borderRadius: BORDER_RADIUS.md,
    alignItems: 'center',
  },
  submitButtonText: {
    color: '#fff',
    fontSize: TYPOGRAPHY.fontSize.base,
    fontWeight: TYPOGRAPHY.fontWeight.bold,
  },
});